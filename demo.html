<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç«‹å§”éæ²³ V2.0 Mobile</title>
    <style>
        :root {
            --bg-sea: #4fc3f7;
            --land-tw: #4caf50;
            --land-cn: #e0e0e0;
            --btn-color: #ff9800;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: "Microsoft JhengHei", sans-serif;
            background-color: var(--bg-sea);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- ä¸Šæ–¹éŠæˆ²å€ (70% é«˜åº¦) --- */
        #game-stage {
            flex: 7;
            position: relative;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* å…©å²¸åœŸåœ° */
        .land {
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding-top: 20px;
            position: relative;
            width: 25%; /* æ‰‹æ©Ÿä¸ŠåœŸåœ°çª„ä¸€é»ï¼Œç•™ç©ºé–“çµ¦æ²³ */
        }

        #land-cn {
            background-color: var(--land-cn);
            border-right: 5px solid #aaa;
            color: #555;
        }
        
        #land-tw {
            background-color: var(--land-tw);
            border-left: 5px solid #2e7d32;
            color: white;
        }

        .land-label {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }

        /* è§’è‰²åœæ”¾å€ (å²¸ä¸Š) */
        .waiting-area {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-content: flex-start;
            gap: 5px;
            width: 100%;
            height: 80%;
        }

        /* æ²³æµèˆ‡èˆ¹ */
        #river {
            flex: 1;
            height: 100%;
            position: relative;
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }

        #boat {
            width: 140px;
            height: 60px;
            background: #795548;
            border-radius: 0 0 30px 30px;
            position: absolute;
            bottom: 20%;
            /* èˆ¹çš„ä½ç½®ç”± JS æ§åˆ¶ left/right % */
            transition: all 0.8s cubic-bezier(0.4, 0.0, 0.2, 1);
            display: flex;
            justify-content: space-around;
            align-items: flex-start; /* è§’è‰²ç«™åœ¨èˆ¹ç·£ */
            padding-top: 5px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            z-index: 10;
            border: 2px solid #3e2723;
        }

        /* èˆ¹ä¸Šçš„åº§ä½æ¨™ç¤º */
        #boat::after {
            content: "è¼‰å®¢é‡: 2";
            position: absolute;
            bottom: 2px;
            font-size: 10px;
            color: rgba(255,255,255,0.6);
        }

        /* --- è§’è‰²æ¨£å¼ --- */
        .char {
            width: 45px; /* æ‰‹æ©Ÿç‰ˆç¨å¾®ç¸®å° */
            height: 45px;
            border-radius: 50%;
            background: white;
            border: 2px solid #333;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            cursor: pointer;
            position: relative;
            box-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            transition: transform 0.1s;
            z-index: 20;
        }
        
        .char:active { transform: scale(0.9); }

        /* è§’è‰²æ¨™ç±¤ (åå­—) */
        .char-name {
            position: absolute;
            bottom: -16px;
            font-size: 10px;
            background: rgba(255,255,255,0.8);
            padding: 1px 3px;
            border-radius: 4px;
            white-space: nowrap;
            font-weight: bold;
            color: black;
        }

        /* å°è©±æ³¡æ³¡ - æ¼«ç•«é¢¨æ ¼ */
        .bubble {
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%) scale(0);
            background: #fff;
            padding: 6px 10px;
            border-radius: 12px;
            border: 2px solid #000;
            font-size: 12px;
            font-weight: bold;
            color: #000;
            white-space: nowrap;
            opacity: 0;
            transition: all 0.3s;
            pointer-events: none;
            z-index: 100; /* ç¢ºä¿æœ€ä¸Šå±¤ */
            box-shadow: 2px 2px 0px rgba(0,0,0,0.2);
        }

        .bubble.show {
            opacity: 1;
            transform: translateX(-50%) scale(1);
        }
        
        /* æ³¡æ³¡çš„å°å°¾å·´ */
        .bubble::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            border-width: 6px 6px 0;
            border-style: solid;
            border-color: #000 transparent transparent transparent;
        }

        /* --- ä¸‹æ–¹æ§åˆ¶å€ (30% é«˜åº¦) --- */
        #control-panel {
            flex: 3;
            background: #fff;
            border-top: 4px solid #333;
            display: flex;
            flex-direction: column;
            padding: 10px;
            box-sizing: border-box;
        }

        #log-box {
            flex: 1;
            overflow-y: auto;
            border: 1px solid #ddd;
            background: #f9f9f9;
            padding: 5px;
            font-size: 12px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        
        #log-box p { margin: 3px 0; border-bottom: 1px dashed #eee; color: #333; }

        /* å·¨å¤§çš„æ“ä½œæŒ‰éˆ• */
        #action-area {
            display: flex;
            gap: 10px;
            height: 60px;
        }

        .btn-big {
            flex: 1;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
        }
        
        .btn-big:active { box-shadow: 0 2px 0 rgba(0,0,0,0.2); transform: translateY(2px); }

        #btn-move { background-color: #d32f2f; font-size: 22px; } /* ç´…è‰²é–‹èˆ¹éˆ• */
        #btn-reset { background-color: #607d8b; flex: 0.3; font-size: 14px; }

    </style>
</head>
<body>

    <div id="game-stage">
        <div id="land-cn" class="land">
            <div class="land-label">ä¸­åœ‹<br><small style="font-size:10px">China</small></div>
            <div id="slots-left" class="waiting-area"></div>
        </div>

        <div id="river">
            <div id="boat"></div>
        </div>

        <div id="land-tw" class="land">
            <div class="land-label">å°ç£<br><small style="font-size:10px">Taiwan</small></div>
            <div id="slots-right" class="waiting-area"></div>
        </div>
    </div>

    <div id="control-panel">
        <div id="log-box">
            <p>ç³»çµ±: éŠæˆ²é–‹å§‹ï¼æ‰€æœ‰äººéƒ½åœ¨å°ç£ã€‚</p>
            <p>ç³»çµ±: è«‹é»æ“Šç«‹å§”ä¸Šä¸‹èˆ¹ã€‚</p>
        </div>
        <div id="action-area">
            <button id="btn-reset" onclick="resetGame()">é‡ç½®</button>
            <button id="btn-move" onclick="moveBoat()">ğŸš¢ é–‹èˆ¹ (Go)</button>
        </div>
    </div>

<script>
    // --- 1. è§’è‰²è¨­å®š (å…¨éƒ¨æ”¾å›ä¾†) ---
    // æ‚¨å¯ä»¥æŠŠ 'emoji' æ›æˆåœ–ç‰‡è·¯å¾‘ '<img src="xx.png" style="width:100%;height:100%;border-radius:50%">'
    const characters = [
        // è—ç‡Ÿ (Blue Team)
        { id: 'fu', name: 'å‚…å´‘è', emoji: 'ğŸ‘‘', quote: 'èŠ±è“®ç‹é§•åˆ°ï¼', team: 'blue' },
        { id: 'hsu', name: 'å¾å·§èŠ¯', emoji: 'ğŸ', quote: 'æˆ‘çš„å¯†éŒ„å™¨å‘¢ï¼Ÿ', team: 'blue' },
        { id: 'lo', name: 'ç¾…æ™ºå¼·', emoji: 'ğŸ¤', quote: 'é€™æ˜¯æ”¿æ²»è¿«å®³ï¼', team: 'blue' },
        // ç¶ ç‡Ÿ/å°æ‰‹ (Green Team) - è£œè¶³äººæ•¸ä»¥ç¬¦åˆé‚è¼¯
        { id: 'ker', name: 'æŸ¯ç¸½å¬', emoji: 'ğŸ‘“', quote: 'å¤ªé›¢è­œäº†ï¼', team: 'green' },
        { id: 'huang', name: 'é»ƒåœ‹æ˜Œ', emoji: 'å’†', quote: 'å¤ªé›¢è­œäº†ï¼', team: 'yellow' }, // é€™è£¡è¨­ç‚ºé»ƒè‰²åŠ›é‡
        { id: 'han', name: 'éŸ“åœ‹ç‘œ', emoji: 'ğŸŸ', quote: 'ç™¼å¤§è²¡ï¼', team: 'blue' }
    ];

    // éŠæˆ²ç‹€æ…‹
    let boatPos = 'right'; // èˆ¹ä¸€é–‹å§‹åœ¨å³é‚Š (å°ç£)
    let passengers = [];   // èˆ¹ä¸Šçš„ä¹˜å®¢ID
    let charLocations = {}; // æ¯å€‹è§’è‰²çš„ä½ç½®: 'left', 'right', 'boat'

    // åˆå§‹åŒ–
    function init() {
        passengers = [];
        // 2. è¨­å®šèµ·é»å…¨éƒ¨åœ¨å°ç£ (right)
        characters.forEach(c => {
            charLocations[c.id] = 'right'; 
        });
        boatPos = 'right';
        render();
        log("æº–å‚™å®Œæˆï¼Œç›®æ¨™æ˜¯å‰å¾€å°å²¸ã€‚");
    }

    // æ¸²æŸ“ç•«é¢
    function render() {
        const leftSlots = document.getElementById('slots-left');
        const rightSlots = document.getElementById('slots-right');
        const boatSlots = document.getElementById('boat');

        leftSlots.innerHTML = '';
        rightSlots.innerHTML = '';
        boatSlots.innerHTML = ''; // æ¸…ç©ºèˆ¹

        // æ›´æ–°èˆ¹çš„ä½ç½® (CSS)
        // æ‰‹æ©Ÿç‰ˆé‚è¼¯ï¼šç”¨ left % ä¾†æ§åˆ¶
        if (boatPos === 'left') {
            boatSlots.style.left = '5%'; 
            boatSlots.style.right = 'auto';
        } else {
            boatSlots.style.left = 'auto';
            boatSlots.style.right = '5%';
        }

        characters.forEach(c => {
            const el = document.createElement('div');
            el.className = 'char';
            // æ ¹æ“šé™£ç‡Ÿçµ¦ä¸€é»å¤–æ¡†é¡è‰²å€åˆ†
            el.style.borderColor = c.team === 'blue' ? '#0000ff' : (c.team === 'green' ? '#00ff00' : '#e6e600');
            
            el.innerHTML = `
                ${c.emoji}
                <span class="char-name">${c.name}</span>
                <div id="bubble-${c.id}" class="bubble">${c.quote}</div>
            `;
            
            el.onclick = () => clickCharacter(c);

            // æ”¾ç½®è§’è‰²
            if (passengers.includes(c.id)) {
                boatSlots.appendChild(el);
            } else {
                if (charLocations[c.id] === 'left') leftSlots.appendChild(el);
                else rightSlots.appendChild(el);
            }
        });
    }

    // é»æ“Šè§’è‰²é‚è¼¯
    function clickCharacter(c) {
        // è§¸ç™¼å°è©±æ³¡æ³¡ (4. å°è©±æ³¡æ³¡ä¿®å¾©)
        showBubble(c.id);

        // åˆ¤æ–·æ˜¯å¦åœ¨èˆ¹ä¸Š
        if (passengers.includes(c.id)) {
            // ä¸‹èˆ¹ï¼šå¿…é ˆä¸‹åˆ°èˆ¹ç›®å‰æ‰€åœ¨çš„å²¸é‚Š
            passengers = passengers.filter(pid => pid !== c.id);
            charLocations[c.id] = boatPos;
            log(`${c.name} ä¸‹èˆ¹åˆ°äº† ${boatPos==='left'?'ä¸­åœ‹':'å°ç£'}`);
        } else {
            // ä¸Šèˆ¹ï¼š
            // 1. è§’è‰²å¿…é ˆè·Ÿèˆ¹åœ¨åŒä¸€é‚Š
            if (charLocations[c.id] !== boatPos) {
                log(`âŒ èˆ¹åœ¨å°é¢ï¼Œ${c.name} éä¸ä¾†ï¼`);
                return;
            }
            // 2. èˆ¹ä¸èƒ½æ»¿ (ä¸Šé™2äºº)
            if (passengers.length >= 2) {
                log("âŒ èˆ¹æ»¿äº† (ä¸Šé™2äºº)ï¼");
                return;
            }
            passengers.push(c.id);
            log(`${c.name} ä¸Šèˆ¹äº†`);
        }
        render();
    }

    // é–‹èˆ¹
    function moveBoat() {
        // 3. é–‹èˆ¹æŒ‰éˆ•æª¢æŸ¥
        if (passengers.length === 0) {
            log("âŒ é€™æ˜¯ç©ºèˆ¹ï¼Œä¸èƒ½é–‹é¬¼èˆ¹ï¼");
            alert("è«‹å…ˆè®“ç«‹å§”ä¸Šèˆ¹ï¼");
            return;
        }

        // é€™è£¡å¯ä»¥åŠ å…¥é‚è¼¯æª¢æŸ¥ (ä¾‹å¦‚ï¼šå¦‚æœå²¸ä¸Šè—ç¶ æ¯”ä¾‹ä¸å°ï¼ŒæŸäººè¢«æ‰“æ­»)
        // æš«æ™‚å…ˆåªåšç§»å‹•åŠŸèƒ½
        
        log("ğŸŒŠ èˆ¹æ­£åœ¨æ¸¡æ²³...");
        
        // åˆ‡æ›ä½ç½®
        boatPos = (boatPos === 'left') ? 'right' : 'left';
        
        render(); // æ›´æ–°ç•«é¢è®“èˆ¹å‹•èµ·ä¾†
        
        setTimeout(() => {
            log(`âœ… æŠµé” ${boatPos==='left'?'ä¸­åœ‹':'å°ç£'}`);
        }, 800);
    }

    // é¡¯ç¤ºæ³¡æ³¡
    function showBubble(id) {
        const b = document.getElementById(`bubble-${id}`);
        if (b) {
            b.classList.add('show');
            // éš¨æ©Ÿæ›å¥è©± (é€²éšåŠŸèƒ½ï¼Œé€™è£¡å…ˆç”¨é è¨­)
            setTimeout(() => {
                b.classList.remove('show');
            }, 2000);
        }
    }

    // è¨˜éŒ„æ–‡å­—
    function log(msg) {
        const box = document.getElementById('log-box');
        const p = document.createElement('p');
        p.textContent = msg;
        box.prepend(p); // æ–°è¨Šæ¯åœ¨æœ€ä¸Šé¢
    }

    function resetGame() {
        if(confirm("ç¢ºå®šè¦é‡ç½®éŠæˆ²å—ï¼Ÿ")) {
            init();
        }
    }

    // å•Ÿå‹•
    init();

</script>
</body>
</html>
